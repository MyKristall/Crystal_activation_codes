<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Раскрой свой КРИСТАЛЛ ДУШИ</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{--bg:#0d1020;--ink:#eaf0ff;--muted:#a7b0d8;--radius:18px;--gap:14px;--shadow:0 10px 30px rgba(0,0,0,.35)}
  *{box-sizing:border-box} body{margin:0;background:#0d1020;color:var(--ink);font-family:Manrope,system-ui,Arial,sans-serif}
  .wrap{max-width:980px;margin:auto;padding:22px}
  h1{margin:8px 0 16px;text-align:center;font-weight:900;letter-spacing:.4px;font-size:clamp(24px,4.8vw,44px)}
  h1 .glow{display:inline-block;color:#ffe69c;text-shadow:0 0 24px rgba(255,217,102,.6),0 0 48px rgba(255,217,102,.25)}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);border-radius:var(--radius);padding:16px;margin:16px 0}
  .row{display:flex;flex-wrap:wrap;gap:14px}.control{flex:1;min-width:240px}
  label{display:block;margin:0 0 6px 6px;font-size:13px;color:var(--muted)}
  input[type="date"],select{width:100%;padding:15px 14px;border-radius:14px;border:1px solid rgba(255,255,255,.12);background:#0f1533;color:var(--ink);outline:none}
  .langbar{display:flex;gap:10px;align-items:end;flex-wrap:wrap}
  .btn{appearance:none;border:0;border-radius:14px;padding:15px 20px;font-weight:800;letter-spacing:.2px;cursor:pointer;transition:.2s transform,.2s box-shadow,.2s filter}
  .btn:active{transform:translateY(1px)}
  .btn.primary{background:linear-gradient(135deg,#71e2ff,#7afcc5);color:#0b1230;box-shadow:0 10px 28px rgba(61,209,255,.28),inset 0 1px 0 rgba(255,255,255,.5)}
  .btn.primary:hover{box-shadow:0 14px 36px rgba(61,209,255,.36),inset 0 1px 0 rgba(255,255,255,.55)}
  .btn.ghost{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.03));color:var(--ink);border:1px solid rgba(255,255,255,.16)}
  .vy{font-size:22px;font-weight:800;margin:8px 0 14px;text-align:center}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .cell{aspect-ratio:1/1;border-radius:18px;display:flex;align-items:center;justify-content:center;font-weight:900;font-size:32px;color:#0d1020;
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.25),0 10px 30px rgba(0,0,0,.28);
    background-image:radial-gradient(circle at 50% 45%,rgba(255,255,255,.65),rgba(255,255,255,0) 55%)}
  /* цвета 1–12 */
  .n-1{background:#ff5757}.n-2{background:#ff9a2f}.n-3{background:#ffe34f}.n-4{background:#b9ff68}
  .n-5{background:#2f6c3b;color:#fff}.n-6{background:#89e8e1}.n-7{background:#1d41ff;color:#fff}
  .n-8{background:#cfeaff}.n-9{background:#9460ff;color:#fff}.n-10{background:#d8b7e8}.n-11{background:#ff5fb1}.n-12{background:#ffd6df}
  .inst h2{margin:0 0 12px}.cards{display:flex;flex-direction:column;gap:14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.09);border-radius:18px;padding:16px 18px}
  .card h3{margin:0 0 8px;font-size:18px;letter-spacing:.3px}.card.red h3{color:#ff7d7d}.card.blue h3{color:#79a8ff}.card.green h3{color:#54e0a3}
  .muted{color:#cdd6ff}.kv{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
  .pill{background:#0f1533;border:1px solid rgba(255,255,255,.12);color:#d4ddff;border-radius:12px;padding:6px 10px;font-size:13px}
  .note{opacity:.85;text-align:center;margin:10px 0 30px;color:#aab3da}
  @media (max-width:720px){.btn{width:100%}.cell{font-size:28px}}
</style>
</head>
<body>
<div class="wrap">
  <h1><span data-i="titleLead">Раскрой свой</span><br><span class="glow">КРИСТАЛЛ ДУШИ</span></h1>

  <section class="panel">
    <div class="row">
      <div class="control" style="flex:2;min-width:260px">
        <label data-i="dob">Дата рождения</label>
        <input id="dob" type="date">
      </div>
      <div class="control">
        <label data-i="lang">Язык</label>
        <div class="langbar">
          <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="uk">Українська</option>
            <option value="bg">Български</option>
          </select>
          <button id="calc" class="btn primary" data-i="calc">Рассчитать</button>
          <button id="pdf" class="btn ghost" data-i="pdf">Скачать PDF</button>
        </div>
      </div>
    </div>
  </section>

  <section class="panel">
    <div class="vy"><span data-i="vy">Уровень Высшего Я:</span> <span id="vyVal">—</span></div>
    <div id="grid" class="grid">
      <!-- P10 P11 P12 / P7 P8 P9 / P4 P5 P6 / P1 P2 P3 -->
      <div class="cell" id="P10">—</div><div class="cell" id="P11">—</div><div class="cell" id="P12">—</div>
      <div class="cell" id="P7">—</div><div class="cell" id="P8">—</div><div class="cell" id="P9">—</div>
      <div class="cell" id="P4">—</div><div class="cell" id="P5">—</div><div class="cell" id="P6">—</div>
      <div class="cell" id="P1">—</div><div class="cell" id="P2">—</div><div class="cell" id="P3">—</div>
    </div>
  </section>

  <section class="panel inst">
    <h2 data-i="instTitle">Инструкция к кодам</h2>
    <div class="cards">
      <article class="card red">
        <h3 data-i="k1title">1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ</h3>
        <div class="muted" id="k1text"></div>
        <div class="kv">
          <span class="pill">N1: <span id="n1v">—</span></span>
          <span class="pill">N2: <span id="n2v">—</span></span>
          <span class="pill">N3: <span id="n3v">—</span></span>
        </div>
      </article>

      <article class="card blue">
        <h3 data-i="k2title">2) ЗАПУСК ТОРСИОННОГО ПОЛЯ</h3>
        <div class="muted" id="k2text"></div>
        <div class="kv">
          <span class="pill">T1: <span id="t1v">—</span></span>
          <span class="pill">T2: <span id="t2v">—</span></span>
          <span class="pill">T3: <span id="t3v">—</span></span>
        </div>
      </article>

      <article class="card green">
        <h3 data-i="k3title">3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА</h3>
        <div class="muted" id="k3text"></div>
        <div class="kv">
          <span class="pill">C1: <span id="c1v">—</span></span>
          <span class="pill">C2: <span id="c2v">—</span></span>
          <span class="pill">C3: <span id="c3v">—</span></span>
        </div>
      </article>
    </div>
  </section>

  <p class="note" data-i="pdfNote">PDF включает матрицу, уровень ВЯ и полные тексты трёх пунктов.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
/* ------- i18n ------- */
const I18N={ru:{titleLead:"Раскрой свой",dob:"Дата рождения",lang:"Язык",calc:"Рассчитать",pdf:"Скачать PDF",vy:"Уровень Высшего Я:",instTitle:"Инструкция к кодам",k1title:"1) АКТИВАЦИЯ КРИСТАЛЛА ДУШИ",k2title:"2) ЗАПУСК ТОРСИОННОГО ПОЛЯ",k3title:"3) ИНТЕГРАЦИЯ ТЕЛА СВЕТА",
k1text:(N1,N2,N3)=>`«Вдыхаю Свет — Выдыхаю Любовь»: ладони в намасте, вдох из центра головы в Высшее сердце; на выдохе — раскрывай руки и излучай золотой свет. <b>N1 = ${N1} раз</b>.<br>«Вдыхаю Силу — Выдыхаю Волю»: вдох из солнечного сплетения в Тимус, выдох золотого света на раскрытых руках. <b>N2 = ${N2} раз</b>.<br>Простукивание точки Тимуса со звуком «аа». <b>N3 = ${N3} раз</b>.`,
k2text:(T1,T2,T3)=>`Верхняя воронка: вращение <u>вокруг своей оси</u> по часовой стрелке, руки вверх. <b>T1 = ${T1} раз</b>.<br>Нижняя воронка: вращение <u>вокруг своей оси</u> против часовой стрелки, руки вниз. <b>T2 = ${T2} раз</b>.<br>Гармонизация: руки в намасте, мягкие прыжки (или резкий перенос с пятки на носок). <b>T3 = ${T3} раз</b>.`,
k3text:(C1,C2,C3)=>`Круги руками вперёд (обе одновременно). <b>C1 = ${C1} раз</b>.<br>Круги руками назад (обе одновременно). <b>C2 = ${C2} раз</b>.<br>Фиксация: ладони в намасте на груди, мягкое надавливание ладонями друг на друга. <b>C3 = ${C3} раз</b>.`,
pdfNote:"PDF включает матрицу, уровень ВЯ и полные тексты трёх пунктов."},
en:{titleLead:"Reveal your",dob:"Date of birth",lang:"Language",calc:"Calculate",pdf:"Download PDF",vy:"Higher Self Level:",instTitle:"Instructions for the codes",k1title:"1) SOUL CRYSTAL ACTIVATION",k2title:"2) TORSION FIELD LAUNCH",k3title:"3) LIGHT BODY INTEGRATION",
k1text:(N1,N2,N3)=>`“I inhale Light — I exhale Love”… <b>N1 = ${N1} times</b>.<br>“I inhale Power — I exhale Will”… <b>N2 = ${N2} times</b>.<br>Tap the thymus point… <b>N3 = ${N3} times</b>.`,
k2text:(T1,T2,T3)=>`Upper vortex… <b>T1 = ${T1} times</b>.<br>Lower vortex… <b>T2 = ${T2} times</b>.<br>Harmonization… <b>T3 = ${T3} times</b>.`,
k3text:(C1,C2,C3)=>`Arm circles forward… <b>C1 = ${C1} times</b>.<br>Arm circles backward… <b>C2 = ${C2} times</b>.<br>Fixation… <b>C3 = ${C3} times</b>.`,
pdfNote:"The PDF includes the matrix, HS level and full texts."},
uk:{titleLead:"Розкрий свій",dob:"Дата народження",lang:"Мова",calc:"Розрахувати",pdf:"Завантажити PDF",vy:"Рівень Вищого Я:",instTitle:"Інструкції до кодів",k1title:"1) АКТИВАЦІЯ КРИСТАЛУ ДУШІ",k2title:"2) ЗАПУСК ТОРСІЙНОГО ПОЛЯ",k3title:"3) ІНТЕГРАЦІЯ ТІЛА СВІТЛА",
k1text:(N1,N2,N3)=>`«Вдихаю Світло — Видихаю Любов»… <b>N1 = ${N1} разів</b>.<br>«Вдихаю Силу — Видихаю Волю»… <b>N2 = ${N2} разів</b>.<br>Постукування тимуса… <b>N3 = ${N3} разів</b>.`,
k2text:(T1,T2,T3)=>`Верхня воронка… <b>T1 = ${T1} разів</b>.<br>Нижня воронка… <b>T2 = ${T2} разів</b>.<br>Гармонізація… <b>T3 = ${T3} разів</b>.`,
k3text:(C1,C2,C3)=>`Кола руками вперед… <b>C1 = ${C1} разів</b>.<br>Кола руками назад… <b>C2 = ${C2} разів</b>.<br>Фіксація… <b>C3 = ${C3} разів</b>.`,
pdfNote:"PDF містить матрицю, рівень ВЯ та повні тексти."},
bg:{titleLead:"Разкрий своя",dob:"Дата на раждане",lang:"Език",calc:"Изчисли",pdf:"Свали PDF",vy:"Ниво на Висшето Аз:",instTitle:"Инструкции към кодовете",k1title:"1) АКТИВИРАНЕ НА КРИСТАЛА НА ДУШАТА",k2title:"2) СТАРТ НА ТОРСИОННОТО ПОЛЕ",k3title:"3) ИНТЕГРАЦИЯ НА ТЯЛОТО НА СВЕТЛИНАТА",
k1text:(N1,N2,N3)=>`„Вдишвам Светлина — Издишвам Любов“… <b>N1 = ${N1} пъти</b>.<br>„Вдишвам Сила — Издишвам Воля“… <b>N2 = ${N2} пъти</b>.<br>Почукване на тимуса… <b>N3 = ${N3} пъти</b>.`,
k2text:(T1,T2,T3)=>`Горна фуния… <b>T1 = ${T1} пъти</b>.<br>Долна фуния… <b>T2 = ${T2} пъти</b>.<br>Хармонизация… <b>T3 = ${T3} пъти</b>.`,
k3text:(C1,C2,C3)=>`Кръгове напред… <b>C1 = ${C1} пъти</b>.<br>Кръгове назад… <b>C2 = ${C2} пъти</b>.<br>Фиксация… <b>C3 = ${C3} пъти</b>.`,
pdfNote:"PDF включва матрица, ниво на Висшето Аз и текстовете."}};
const L=()=>document.getElementById('lang').value||'ru';
function applyLang(){const t=I18N[L()];document.querySelectorAll('[data-i]').forEach(el=>{const k=el.getAttribute('data-i');if(t[k])el.textContent=t[k];});document.documentElement.lang=L();}

/* ------- математика ------- */
const sumDigits=n=>String(Math.abs(n)).split('').reduce((a,b)=>a+ +b,0);
const to12=n=>{let m=n;while(m>12)m=sumDigits(m);return m||12};
function buildPositions(iso){const [Y,M,D]=iso.split('-').map(Number);
  const P1=to12(sumDigits(D)),P2=to12(M),P3=to12(sumDigits(Y));
  const P4=to12(P1+P2),P5=to12(P1+P3),P6=to12(P2+P3);
  const P7=to12(P4+P5),P8=to12(P4+P6),P9=to12(P5+P6);
  const P10=to12(P7+P8),P11=to12(P7+P9),P12=to12(P8+P9);
  return {Y,M,D,P1,P2,P3,P4,P5,P6,P7,P8,P9,P10,P11,P12};}
function computeVY({Y,M,D}){return D+M+Math.floor(Y/100)+Math.floor((Y%100)/10);}
function computeCodes(P){const N1=P.P5,N2=P.P8,N3=to12(P.P5+P.P8);
  const T1=to12(P.P8+P.P10+P.P12),T2=to12(P.P1+P.P3+P.P5),T3=to12(T1+T2);
  const C1=to12(P.P2+P.P4+P.P6),C2=to12(P.P7+P.P9+P.P11),C3=to12(C1+C2);
  return {N1,N2,N3,T1,T2,T3,C1,C2,C3};}

/* ------- отрисовка ------- */
function setCell(el,val){el.textContent=val;el.className='cell n-'+val;}
function drawGrid(P){["P10","P11","P12","P7","P8","P9","P4","P5","P6","P1","P2","P3"].forEach(id=>setCell(document.getElementById(id),P[id]));}
function drawInstructions(P){
  const t=I18N[L()],{N1,N2,N3,T1,T2,T3,C1,C2,C3}=computeCodes(P);
  document.getElementById('k1text').innerHTML=t.k1text(N1,N2,N3);
  document.getElementById('k2text').innerHTML=t.k2text(T1,T2,T3);
  document.getElementById('k3text').innerHTML=t.k3text(C1,C2,C3);
  // строго числа в отдельные <span> (никаких DOM-объектов)
  document.getElementById('n1v').innerText=N1; document.getElementById('n2v').innerText=N2; document.getElementById('n3v').innerText=N3;
  document.getElementById('t1v').innerText=T1; document.getElementById('t2v').innerText=T2; document.getElementById('t3v').innerText=T3;
  document.getElementById('c1v').innerText=C1; document.getElementById('c2v').innerText=C2; document.getElementById('c3v').innerText=C3;
}
function recalc(){const iso=document.getElementById('dob').value; if(!iso){alert('Выбери дату / Select a date');return;}
  const P=buildPositions(iso); drawGrid(P); document.getElementById('vyVal').textContent=computeVY(P); drawInstructions(P);}

/* ------- PDF (устойчивее на мобилках) ------- */
document.getElementById('pdf').addEventListener('click', async ()=>{
  try{
    const { jsPDF } = window.jspdf; const t=I18N[L()]; const pdf=new jsPDF({unit:"pt",format:"a4"}); const pw=pdf.internal.pageSize.getWidth(),ph=pdf.internal.pageSize.getHeight();
    const shot=async(node)=>{const tmp=document.createElement('div');tmp.style.position='fixed';tmp.style.left='-9999px';tmp.style.top='0';tmp.style.width='920px';tmp.appendChild(node);document.body.appendChild(tmp);
      const canvas=await html2canvas(node,{backgroundColor:"#0d1020",scale:2,useCORS:true}); document.body.removeChild(tmp);
      const img=canvas.toDataURL('image/png'); const r=Math.min((pw-80)/canvas.width,(ph-120)/canvas.height); pdf.addImage(img,'PNG',40,40,canvas.width*r,canvas.height*r);};

    // титул
    pdf.setFillColor(13,16,32); pdf.rect(0,0,pw,ph,'F'); pdf.setTextColor(255,255,255); pdf.setFont("helvetica","bold"); pdf.setFontSize(28); pdf.text(t.titleLead,60,120);
    pdf.setTextColor(255,230,156); pdf.setFontSize(42);
    const soul=(L()==='en'?'SOUL CRYSTAL':L()==='uk'?'КРИСТАЛ ДУШІ':L()==='bg'?'КРИСТАЛ НА ДУШАТА':'КРИСТАЛЛ ДУШИ'); pdf.text(soul,60,170);

    // матрица
    pdf.addPage(); const m=document.querySelectorAll('.panel')[1].cloneNode(true); m.style.background='transparent'; m.style.boxShadow='none'; await shot(m);
    // инструкция
    pdf.addPage(); const i=document.querySelectorAll('.panel')[2].cloneNode(true); i.style.background='transparent'; i.style.boxShadow='none'; await shot(i);

    pdf.save((L()==='en'?'Soul_Crystal':L()==='uk'?'Kristal_dushi':L()==='bg'?'Kristal_na_dushata':'Kristall_dushi')+'.pdf');
  }catch(e){alert('Не удалось сформировать PDF: '+e.message);}
});

/* ------- init ------- */
document.getElementById('calc').addEventListener('click',recalc);
document.getElementById('lang').addEventListener('change',()=>{applyLang(); const v=document.getElementById('vyVal').textContent.trim(); if(v!=='—') recalc();});
(function(){document.getElementById('dob').value='1969-05-22'; applyLang(); recalc();})();
</script>
</body>
</html>
